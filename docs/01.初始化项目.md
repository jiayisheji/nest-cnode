# åˆå§‹åŒ–é¡¹ç›®

å¤äººäº‘:å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ï¼Œè¿™é‡Œç»™å¤§å®¶å‡†å¤‡ `windows` ç©å®¶å¿…å¤‡çš„è½¯ä»¶ï¼Œ[ä¼ é€é—¨](https://pan.baidu.com/s/1kQwJx4WpgMz1Lti0Y9moNg)ï¼Œå£ä»¤ï¼šã€9ofrã€‘ã€‚

æ¥ä¸‹æ¥éœ€è¦å¾ˆå¤šå‘½ä»¤è¡Œæ“ä½œï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¼ºå¤§çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œ`Windows 10` å·²ç»æ¨å‡ºäº† [windows terminal](https://github.com/Microsoft/Terminal)ï¼Œéœ€è¦è‡ªå·±æ‰‹åŠ¨[å®‰è£…](https://apps.microsoft.com/store/detail/windows-terminal/9N0DX20HK701?hl=zh-cn&gl=cn)ï¼ŒWindows 11 é»˜è®¤å‘½ä»¤è¡Œå·¥å…·ã€‚å¯ä»¥è‡ªè¡Œæœç´¢ç¾å¥½å·¥å…·ï¼Œé…åˆ `oh-my-posh` æ‰“é€ å¥½ç”¨çš„å‘½ä»¤è¡Œå·¥å…·ã€‚

å—é™ç½‘ç»œåŸå› ï¼Œæˆ–è€…æ‡’å¾—æŠ˜è…¾ï¼Œæˆ–è€…æŠ˜è…¾å¤±è´¥ï¼Œæ¨èä½¿ç”¨ [cmder](cmder.net)ã€‚å¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•å®‰è£…å’Œä½¿ç”¨ï¼Œé‚£ä¹ˆéœ€è¦æ±‚è§£æœç´¢å¼•æ“äº†ï¼Œæ‰“å¼€æµè§ˆå™¨ [ä¼ é€é—¨](https://cn.bing.com/search?q=cmder&qs=n&form=QBRE&sp=-1&pq=cmder&sc=8-5&sk=&cvid=DA71E8C8A5914CAB9236A8C0F193C787)ã€‚

æœ‰äº†å‘½ä»¤è¡Œå·¥å…·éœ€è¦ä¸€ä¸ªä¸é”™çš„ç¼–è¾‘å™¨ï¼Œè¿™é‡Œæ¨è [vs code](https://code.visualstudio.com/)ï¼Œç‚¹å‡»ä¸‹è½½å®‰è£…ã€‚

æ¨èä¸€äº›æˆ‘å¸¸ç”¨çš„å¿…å¤‡æ’ä»¶(ps: æ’ä»¶ä¸è¦å¤ªå¤šï¼Œæœ‰äº›æ’ä»¶æ¯”è¾ƒå‘ï¼Œçƒ§å†…å­˜å’Œ cpuï¼Œæ³¨æ„è¾¨åˆ«)å’Œé…ç½®ï¼š

é¡¹ç›®æ ¹ç›®å½•ä¸‹ä¼šæœ‰ `.vscode` æ–‡ä»¶å¤¹

```text
.vscode/extensions.json  // å¿…å¤‡æ’ä»¶
.vscode/launch.json      // æ–­ç‚¹è°ƒè¯•é…ç½®
.vscode/settings.json    // é¡¹ç›®é…ç½®
```

## ä½¿ç”¨ `nvm` å®‰è£… `nodejs`

ä¸€èˆ¬å¼€å‘ `nodejs` éƒ½éœ€è¦å®‰è£… `nodejs` ç¯å¢ƒï¼Œéšç€ `nodejs` ç‰ˆæœ¬ä¸æ–­è¿­ä»£ï¼Œæœ‰ç§è·Ÿä¸ä¸ŠèŠ‚å¥ï¼Œä¸åŒç‰ˆæœ¬ä¼šæœ‰ä¸€äº›å·®å¼‚åŒ–ï¼Œå¦‚æœä½ ç°åœ¨å¼€å‘ç¯å¢ƒæ˜¯æ—©æœŸ nodejs ç‰ˆæœ¬ï¼Œé‚£ä¹ˆä½ å¼€å¿ƒæ›´æ–°ç‰ˆæœ¬ï¼Œå¯èƒ½å°±ä¼šå“­äº†ï¼Œä¼šæŠ¥å„ç§æ‡µé€¼çš„é”™è¯¯è®©ä½ æ¬²ç½¢ä¸èƒ½ã€‚é‚£æ€ä¹ˆåŠäº†ï¼Œå°±æœ‰ä¸€ä¸ª `node` ç‰ˆæœ¬ç®¡ç†çš„å·¥å…·---[nvm](https://github.com/creationix/nvm)è¯ç”Ÿã€‚ï¼ˆpsï¼šè¿™ä¸ªæ˜¯ windows ç”¨æˆ·ç”¨ä¸äº†ï¼Œå¿…å¤‡è½¯ä»¶é‡Œé¢ `nvm-setup` å°±æ˜¯ windows ç”¨æˆ·ä¸“ç”¨ï¼‰

å¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•å®‰è£…å’Œä½¿ç”¨ `nvm-windows` [ä¼ é€é—¨](https://cn.bing.com/search?q=nvm-windows&qs=n&form=QBRE&sp=-1&pq=nvm-windows&sc=8-11&sk=&cvid=8F45D5194FCC45F098E949612179D489)ã€‚

> **æ³¨æ„**ï¼šå¦‚æœç”µè„‘å·²ç»å®‰è£…è¿‡`nodejs`ï¼Œéœ€è¦å…ˆå¸è½½ï¼Œè¯·è®°ä½å®ƒçš„ç‰ˆæœ¬å·ï¼Œåœ¨å®‰è£… `nvm-windows`ã€‚

ç°åœ¨ä½ åº”è¯¥å®‰è£…å®Œæˆäº† `nvm-windows`ï¼Œé‚£ä¹ˆå°±å¯ä»¥å¼€å§‹å®‰è£… `nodejs` ç‰ˆæœ¬ï¼Œå¦‚æœä½ ä¹‹å‰æœ‰å®‰è£… `nodejs` ï¼Œè¯·å…ˆ:(ä¾‹å¦‚æˆ‘ä¹‹å‰å®‰è£… v12.13)

```bash
nvm install v12.13
```

å®‰è£…å®Œæˆä»¥åå†å®‰è£…æœ¬é¡¹ç›®ä½¿ç”¨ç‰ˆæœ¬ï¼š

```bash
nvm install v14.15.0
```

å®‰è£…è¿‡ç¨‹å¯èƒ½ä¼šå‡ºç°ä¸€ä¸ªé”™è¯¯ï¼Œä¸‹è½½`npm`é”™è¯¯ï¼š

```text
Please visit https://github.com/npm/npm/releases/tag/v[npmç‰ˆæœ¬] to download npm.
```

è¦ä½ å»è¿™ä¸ªåœ°å€ä¸‹è½½ï¼Œå…¶å®æ˜¯é”™è¯¯ï¼Œè¿™ä¸ªæŒ‡å‘æ˜¯`npm-cli`v[npm ç‰ˆæœ¬]ï¼Œæˆ‘ä»¬éœ€è¦æ‰‹åŠ¨å»ä¸‹è½½å®ƒ

```text
https://codeload.github.com/npm/cli/zip/v[npmç‰ˆæœ¬]
```

æŠŠå®ƒæ‹·è´åˆ°ä½ çš„ `nvm` ç›®å½•ä¸‹ï¼Œå¯¹åº”ç‰ˆæœ¬`nodejs`ç‰ˆæœ¬ï¼Œè§£å‹åˆ°`node_modules`é‡Œï¼ŒæŠŠæ–‡ä»¶å¤¹é‡å‘½åä¸º`npm`ã€‚ä¸‹è½½å¿…å¤‡çš„è½¯ä»¶é‡Œé¢çš„`npm`æ–‡ä»¶å¤¹ï¼ŒæŠŠé‡Œé¢å†…å®¹æ‹·è´åˆ°å¯¹åº”ç‰ˆæœ¬`nodejs`ç‰ˆæœ¬å³å¯ã€‚

å¦å¤–ä¸€ç§å°±æ˜¯å€ŸåŠ©æ·˜å®æºï¼š

å®‰è£…ç›®å½• `\nvm\settings.txt` åœ¨è¿™ä¸ªæ–‡ä»¶åé¢è·Ÿä¸Šè¿™ 2 å¥

```text
node_mirror: https://registry.npmmirror.com/binary.html?path=node/
npm_mirror: https://registry.npmmirror.com/binary.html?path=npm/
```

ç„¶å `nvm install v14.15.0`ï¼ŒæŒ‰æç¤ºæ“ä½œå³å¯ã€‚ï¼ˆå¦‚æœå‡ºç°æç¤ºæ²¡æœ‰å¯ç”¨çš„ç‰ˆæœ¬ï¼Œç§»é™¤æ·˜å®æºï¼‰

åˆ‡æ¢å½“å‰ç‰ˆæœ¬å¹¶æ£€æŸ¥æ˜¯å¦é è°±ï¼š

```bash
nvm use v14.15.0
node -v   // v14.15.0
npm -v    // v6.14.8
# exit status 1: åœ¨åˆ‡æ¢æ—¶å¦‚æœé‡åˆ°è¿™ä¸ªé”™è¯¯ï¼Œè¯·ä½¿ç”¨ç®¡ç†å‘˜æƒé™æ‰“å¼€ç»ˆç«¯
```

**æ³¨æ„**ï¼š`nvm-windows`ä¸€å®šè¦å®‰è£…å¥½ï¼Œæ£€æŸ¥é è°±ï¼Œåªä¼šå‡ºç° `npm -v` ä¼šæŠ¥é”™ï¼Œå¦‚æœä½ æŒ‰æˆ‘çš„ä½¿ç”¨æ–¹å¼å°±ä¸ä¼šå‡ºç°é—®é¢˜ã€‚å¦‚æœä½ åœ¨å‡ºé—®é¢˜äº†ï¼Œå¯ä»¥è”ç³»æˆ‘å¸®ä½ çœ‹çœ‹ã€‚

### .nvmrc å’Œ .npmrc é…ç½®

åˆ›å»º `.nvmrc` æ–‡ä»¶ï¼Œé‡Œé¢å†™ä¸Š `14.15.0` æŒ‡å®šç‰ˆæœ¬

> æ³¨æ„ï¼šnvm-windows å¯¹æ­¤é…ç½®å¯èƒ½æ— æ•ˆ

åˆ›å»º `.npmrc` æ–‡ä»¶ï¼Œé‡Œé¢å†™ä¸Š `registry=https://registry.npmmirror.com/` æ·˜å®é•œåƒæº

## ä½¿ç”¨ Nx æ„å»ºé¡¹ç›®

### Nx æ˜¯ä»€ä¹ˆ

`Nx` æ˜¯ä¸€ç»„é’ˆå¯¹ `monorepos` çš„å¯æ‰©å±•å¼€å‘å·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©ä½ åƒ `Google`ã€`Facebook` å’Œ `Microsoft` é‚£æ ·è¿›è¡Œå¼€å‘ã€‚å®ƒå¯¹è®¸å¤šå‰ç«¯å’Œåç«¯æŠ€æœ¯æä¾›ä¸€æµçš„æ”¯æŒï¼Œå› æ­¤å…¶æ–‡æ¡£å…·æœ‰å¤šç§é£æ ¼ã€‚

#### ä½¿ç”¨ç°ä»£å·¥å…·

ä½¿ç”¨ `Nx`ï¼Œä½ å¯ä»¥å°† `TypeScript`ï¼Œ`Cypress`ï¼Œ`Jest`ï¼Œ`Prettier`ï¼Œ`Storybook` æ·»åŠ åˆ°ä½ çš„å¼€å‘å·¥ä½œæµç¨‹ä¸­ã€‚ `Nx` è®¾ç½®äº†è¿™äº›å·¥å…·ï¼Œå¹¶å…è®¸ä½ æ— ç¼ä½¿ç”¨å®ƒä»¬ã€‚ è¿™äº›åˆ›æ–°å·¥å…·å…·æœ‰å¾ˆå¤šä¼˜åŠ¿ï¼Œå¯ä»¥å¸®åŠ©ä½ æ›´å¥½ï¼Œæ›´çœå¿ƒåœ°å·¥ä½œã€‚

#### æ„å»ºå…¨æ ˆåº”ç”¨ç¨‹åº

ä½¿ç”¨`Nx`ï¼Œä½ å¯ä»¥ä½¿ç”¨ç°ä»£æ¡†æ¶æ„å»ºå…¨æ ˆåº”ç”¨ç¨‹åºã€‚ ä½ å¯ä»¥åœ¨å‰ç«¯å’Œåç«¯ä¹‹é—´å…±äº«ä»£ç ã€‚ ä½ å¯ä»¥ä½¿ç”¨ç›¸åŒçš„ `build`/`test`/`serve` å‘½ä»¤æ¥å¢å¼ºæ•´ä¸ªå¼€å‘ç»éªŒã€‚

#### å­¦ä¹  Googleï¼ŒFacebook å’Œ Microsoft ä¸€æ ·å¼€å‘å®è·µ

ä½¿ç”¨`Nx`ï¼Œä½ å¯ä»¥æ•´ä½“å¼€å‘å¤šä¸ªå…¨æ ˆåº”ç”¨ç¨‹åºï¼Œå¹¶åœ¨åŒä¸€å·¥ä½œåŒºä¸­å…±äº«å®ƒä»¬ä¹‹é—´çš„ä»£ç ã€‚ `Nx` æä¾›äº†é«˜çº§å·¥å…·ï¼Œå¯å¸®åŠ©ä½ æ‰©å±•ä¼ä¸šå‘å±•ã€‚ `Nx` è¿˜æœ‰åŠ©äºå®æ–½ç»„ç»‡çš„æ ‡å‡†å’Œç¤¾åŒºæœ€ä½³å®è·µã€‚

#### ä¸åŒæŠ€æœ¯æ ˆç»„åˆï¼Œç»Ÿä¸€æ„å»ºå·¥å…·

ä½¿ç”¨`Nx`ï¼Œä½ å¯ä»¥`Angular`ã€`React`ã€`Web Components`ã€`Nestjs`ã€`Express`ã€`Nodejs`æŠ€æœ¯åšè‡ªç”±ç»„åˆï¼Œæ„å»ºä½ çš„é¡¹ç›®æŠ€æœ¯æ ˆã€‚ä¸ç”¨æ‹…å¿ƒæ„å»ºå·¥å…·é—®é¢˜ï¼Œ`Nx` å¸®ä½ ä¸€é”®æå®šã€‚

### monorepo å’Œ multrepo

#### ä»€ä¹ˆæ˜¯ monorepo

> æ˜¯å°†æ‰€æœ‰çš„æ¨¡å—ç»Ÿä¸€çš„æ”¾åœ¨ä¸€ä¸ªä¸»å¹²åˆ†æ”¯ä¹‹ä¸­ç®¡ç†ã€‚ä¸è¿›è¡Œåˆ†åº“å­˜å‚¨ï¼Œå½“æœ‰ç‰¹å®šçš„éœ€è¦çš„æ—¶å€™è¿›è¡Œåˆ†æ”¯ï¼Œä½†æ˜¯é—®é¢˜ä¿®æ”¹è¿˜æ˜¯åœ¨ä¸»å¹²ä¸Šæ“ä½œï¼Œå¹¶æœ‰ä¸“é—¨äººå‘˜åˆå¹¶åˆ°åˆ†æ”¯å†…å®¹ä¸Šï¼Œåœ¨ç‰¹å®šéœ€æ±‚å®Œç»“çš„æ—¶å€™ï¼Œåˆ†æ”¯ä¹Ÿå°†ä¼šè¢«åºŸå¼ƒã€‚å¦‚æœæƒ³äº†è§£æ›´å¤šï¼Œ[ä¼ é€é—¨](https://trunkbaseddevelopment.com/monorepos/)ã€‚

ä¼˜ç‚¹ï¼š

1. ç»Ÿä¸€çš„è§„èŒƒï¼Œè¯­è¨€ï¼Œå’Œ IDE å¸¦æ¥çš„æ˜¯ç»“æ„çš„å®Œæ•´ç¨³å®šã€‚
2. æŒ‰ç…§ç»Ÿä¸€çš„æ ‡å‡†è¿›è¡Œå¼€å‘ï¼Œæ˜¯å“¦ç¨‹åºç¨³å®šæ€§æ›´è‰¯å¥½ï¼Œæ›´æ˜“è§£è¯»ã€‚
3. æ ‡å‡†åŒ–çš„å¼€å‘æµç¨‹ï¼Œè§„é¿å¾ˆå¤šä¸å¿…è¦çš„å†²çªä¸é”™è¯¯ã€‚

ç¼ºç‚¹ï¼š

1. é¡¹ç›®è¿‡å¤§ï¼Œéš¾ä»¥ç®¡ç†ã€‚
2. ç”±äºç»Ÿä¸€çš„æ ‡å‡†ï¼Œä¸åŒçš„å›¢é˜Ÿå¯èƒ½éœ€è¦å¯¹äºæ–°çš„è§„èŒƒå’Œ IDE è¿›è¡Œäº†è§£å­¦ä¹ ï¼Œéœ€è¦æ—¶é—´ã€‚
3. ä¿®æ”¹å’Œå¼€å‘å¯èƒ½å˜å¾—ç¹çï¼Œå‡æ…¢æ•ˆç‡ã€‚

#### ä»€ä¹ˆæ˜¯ multrepo

> å°†é¡¹ç›®åˆ†åŒ–æˆä¸ºå¤šä¸ªæ¨¡å—ï¼Œå¹¶é’ˆå¯¹æ¯ä¸€ä¸ªæ¨¡å—å•ç‹¬çš„å¼€è¾Ÿä¸€ä¸ª repository æ¥è¿›è¡Œç®¡ç†ã€‚

ä¼˜ç‚¹ï¼š

1. å›¢é˜Ÿè‡ªå·±çš„ IDEï¼Œè¯­è¨€ï¼Œä»¥åŠå·¥ä½œæ­¥è°ƒã€‚
2. æ¨¡å—æ›´å°ï¼Œæ›´æ˜“ç»´æŠ¤ã€‚
3. å¼€å‘æ•ˆç‡æ›´é«˜ã€‚

ç¼ºç‚¹ï¼š

1. åˆå¹¶å›°éš¾ï¼Œæ¯ä¸ªæ¨¡å—è§„èŒƒä¸åŒï¼ŒåŒæ­¥å’Œç¼–è¯‘æ—¶è¿™äº›é—®é¢˜å°†ä¼šé›†ä½“çˆ†å‘ã€‚
2. éš¾ä»¥ä¿è¯ç¨³å®šæ€§ã€‚
3. ç”±äºå¯èƒ½å­˜åœ¨ä¸åŒè¯­è¨€å¼€å‘ï¼Œæˆ–è€…ä¸åŒ IDE çš„æƒ…å†µï¼Œæ–°å»ºæˆ–è€…æ›´æ–°æ„å»ºå˜å¾—å›°éš¾ã€‚

#### ä¸ºä»€ä¹ˆé€‰æ‹© Nx

æƒ³è¦ä½¿ç”¨ `monorepo` éœ€è¦å€ŸåŠ©ä¸€ä¸ªå¼ºå¤§çš„å·¥å…·æ‰èƒ½é«˜æ•ˆçš„å‘æŒ¥ä½œç”¨ã€‚

è¿™é‡Œæœ‰å…³äº [monorepo tools](https://monorepo.tools) å’Œ monorepo æ·±å…¥ä»‹ç»å’Œå­¦ä¹ èµ„æ–™ï¼Œé‡Œé¢æœ‰ç›®å‰ github æµè¡Œçš„ monorepo toolsï¼Œç»¼åˆå¯¹æ¯”æ¥è¯´ `Nx` æ˜¯ä¸€æ¬¾ä¸é”™çš„ monorepo tools

> Nx æœ€å¼€å§‹æ˜¯ä¸€ä¸ª [Angular-cli](https://github.com/angular/angular-cli) çš„æ‰©å±•å·¥å…·ï¼Œå­¦ä¹ å®ƒæˆæœ¬ä¸é«˜ï¼Œåªéœ€è¦ä½ æŒ‰ç…§ä¸‹åˆ—æ–¹å¼å®‰è£…å°±è¡Œäº†ï¼Œä½¿ç”¨éå¸¸ç®€å•ï¼Œå­¦ä¹ æ›´å¤š[ä½¿ç”¨æ–‡æ¡£](https://nx.dev)

`Nx` çš„äº®ç‚¹å¾ˆå¤šï¼Œè¿™é‡Œç®€å•ä»‹ç»ä¸€äº›ï¼š

- æ”¯æŒ `React` æ„å»º
- æ”¯æŒ `React` å’Œ `Angular` å…±å­˜ä¸€ä¸ªé¡¹ç›®ä¸­
- æ”¯æŒé€‰æ‹©æµ‹è¯•å·¥å…·ï¼Œå¯ä»¥é€‰æ‹©`jest`å’Œ`cypress`
- æ”¯æŒå…¨æ ˆ `node` é¡¹ç›®ä¸€èµ·æ„å»º
- æ„å»ºå¤šä¸ª `apps`
- æ„å»ºå¤šä¸ª `libs`

> æœ€åï¼Œ`Nx` é¼“åŠ±å¼€å‘è€…åœ¨ä½¿ç”¨è‡ªå®šä¹‰ `library`ï¼Œæ¥æ„å»ºé¡¹ç›®ï¼Œè®©ä½ çš„ `Apps` ç®€æ´æ˜äº†ã€‚

å¦‚æœä½ å–œæ¬¢å›¾å½¢ç•Œé¢ï¼Œå¯ä»¥è¯•è¯• [Angular Console](https://angularconsole.com/)ã€‚

`Nx` è¿˜æœ‰ä¸€ä¸ªæ¯”è¾ƒå¤§äº®ç‚¹ï¼Œå€ŸåŠ© `Angular-cli` å¼€æºçš„ [schematics](https://www.npmjs.com/package/@angular-devkit/schematics-cli) å·¥å…·ï¼Œå¼€æºå¿«é€Ÿç”Ÿæˆæƒ³è¦æ¨¡æ¿ï¼Œè¿˜å¯ä»¥å®šåˆ¶å·¥ä½œåŒºæ¨¡æ¿ [tools/generators](https://nx.dev/generators/workspace-generators)ã€‚

`Nx` è¿˜è¦æ›´åŠ çµæ´»çš„æ‰©å±•æ‰§è¡Œå‘½ä»¤åŠŸèƒ½ï¼š

- é€šè¿‡ [nx:run-commands](https://nx.dev/executors/run-commands-builder) æ‰§è¡Œè„šæœ¬å‘½ä»¤æ¥å¼ºåŒ–é»˜è®¤ `executor` æ‰§è¡Œå‘½ä»¤ã€‚
- ç®€å•å®šåˆ¶å·¥ä½œåŒº [tools/executors](https://nx.dev/executors/creating-custom-builders) æ¥å¼ºåŒ–é»˜è®¤ `executor` æ‰§è¡Œå‘½ä»¤ã€‚

å®šåˆ¶è‡ªå·±çš„[æ’ä»¶](https://nx.dev/extending-nx/nx-devkit)æ¥æ‰©å±•é¡¹ç›®çš„ `generators` å’Œ `executor` èƒ½åŠ›ã€‚

#### å®‰è£… Nx

Nx åˆå§‹åŒ–å«åˆ›å»ºå·¥ä½œåŒºï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸‰ç§æ–¹å¼å®‰è£…

npx

```bash
npx create-nx-workspace@latest
```

npm init

```bash
npm init nx-workspace
```

yarn create

```bash
yarn create nx-workspace
```

æˆ‘ä»¬è¿™é‡Œä½¿ç”¨ `npx`ï¼Œå®ƒä»¬æœ‰ä»€ä¹ˆä¸åŒï¼Œè¿™é‡Œå°±ä¸å±•å¼€è¯´æ˜ï¼Œè‡ªè¡Œæœç´¢å¼•æ“ç§‘æ™®ã€‚

è¿è¡Œä¸Šé¢å®‰è£…å‘½ä»¤è¡Œä»¥åï¼Œå°±ç­‰ç€å‡ºç° `npx: 166 å®‰è£…æˆåŠŸï¼Œç”¨æ—¶ 42.249 ç§’`

å¡«å†™å·¥ä½œåŒºçš„åå­—ï¼š

- Workspace nameï¼š`nest-cnode`

ç„¶åå°±ä¼šå‡ºç°æœ‰å¥–çŸ¥è¯†é—®ç­”ç¯èŠ‚ï¼šé€‰æ‹© `angular-nest`

- What to create in the new workspace (Use arrow keys)ï¼š

  - empty [an empty workspace]
  - web components [a workspace with a single app built using web components]
  - angular [a workspace with a single Angular application]
  - angular-nest [a workspace with a full stack application (Angular + Nest)]
  - react [a workspace with a single React application]
  - react-express [a workspace with a full stack application (React + Express)]
  - next.js [a workspace with a single Next.js application]

- Application nameï¼šadmin (è¿™é‡Œæ˜¯ç¬¬ä¸€æ¬¡åˆ›å»º angular é¡¹ç›®çš„åå­—ï¼Œ)

- Default stylesheet formatï¼šé€‰æ‹© `SASS` (éœ€è¦ä½¿ç”¨ [@angular/material](https://github.com/angular/components), åªèƒ½é€‰æ‹©ï¼Œå¦‚æœä½ ä½¿ç”¨ [NG-ZORRO](https://github.com/NG-ZORRO/ng-zorro-antd) å¯ä»¥é€‰æ‹© `LESS`)

  - CSS
  - SASS(.scss) [ <http://sass-lang.com> ]
  - Stylus(.styl) [ <http://stylus-lang.com> ]
  - LESS [ <http://lesscss.org> ]

é€‰æ‹©ä¹‹åï¼Œå‡ºç° `Creating a sandbox with Nx...`ï¼Œç­‰å¾…å®‰è£… `node_modules`ï¼Œå®‰è£…å®Œæˆä»¥åæ‰“å¼€ `vs code` å°±å¥½æç¤ºå®‰è£…æ’ä»¶ï¼Œå®‰è£…å°±å¥½äº†ï¼Œå…¶ä¸­ä¸€ä¸ªå« `nx-console`ï¼Œè¿™æ˜¯ `nx` çš„ `vs code` æ’ä»¶ï¼Œåé¢ç”Ÿæˆæ–‡ä»¶ï¼Œç”Ÿæˆ `lib`ï¼Œç­‰å…¨é å®ƒã€‚

> ç›®å‰å®‰è£… `nx` æ–¹å¼å¾ˆå¤šï¼Œç»“æœä¹Ÿä¸ä¸€æ ·ï¼ŒæŒ‰ä¸Šé¢æ–¹å¼å®‰è£…ï¼Œå¦‚æœæœ‰ä¸€ä¸ª `angular.json`, ä½ éœ€è¦æŠŠå®ƒ `version` æ”¹æˆ 2ï¼Œç„¶åä½¿ç”¨ `vs code` çš„ `nrwl.angular-console` ç‚¹å‡» `Generate`ï¼Œæ‰¾åˆ° `@nrwl/workspace:convert-to-nx-project`, å‹¾é€‰ `all`, å®Œæˆå·¥ä½œåŒºè¿ç§»ï¼Œè¿™æ ·å°±ä¼šç”Ÿæˆä¸€ä¸ª `workspace.json` æ–‡ä»¶ï¼Œè¿™æ ·è¿™ä¸ªæ–‡ä»¶åªæœ‰ç›¸å…³é¡¹ç›®å’Œè·¯å¾„æ˜ å°„ï¼Œå¤§å¤§å‡å°‘äº† `workspace.json` æ–‡ä»¶çš„å¤§å°ï¼Œæ¯ä¸ªé¡¹ç›®éƒ½ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ª `project.json` æ–‡ä»¶æ¥ç®¡ç†å½“å‰é¡¹ç›®çš„é…ç½®ã€‚

## é¡¹ç›®è§„åˆ’

å…³äº [cnodejs](https://cnodejs.org) ç¤¾åŒºæ˜¯ä¸€ä¸ªæœåŠ¡ç«¯æ¸²æŸ“çš„ç½‘ç«™ï¼Œç”¨æˆ·å’Œç®¡ç†å‘˜éƒ½æ˜¯åŒæ—¶å­˜åœ¨ï¼Œç®¡ç†å‘˜ç™»å½•æœ‰æ›´å¤šçš„æƒé™æ“ä½œã€‚æ”¯æŒç¬¬ä¸‰æ–¹ `github` ç™»å½•ï¼Œä½¿ç”¨ `Session + Cookie` èº«ä»½æ ¡éªŒã€‚

ä¸ºäº†æ›´åŠ ä¸°å¯ŒåŠŸèƒ½ï¼Œåšäº†ä¸€äº›è°ƒæ•´ï¼Œé¢å‘ç”¨æˆ·è¿˜æ˜¯æœåŠ¡ç«¯æ¸²æŸ“ï¼Œé¢å‘ç®¡ç†å‘˜å•ç‹¬åšä¸€ä¸ªç®¡ç†åå°ï¼Œä½¿ç”¨å•é¡µåº”ç”¨ã€‚

ç®€å•ç†è§£å°±æ˜¯ï¼Œä¸€ä¸ªæœåŠ¡ç«¯æ¸²æŸ“åç«¯å·¥ç¨‹ï¼Œä¸€ä¸ªå•é¡µé¢åº”ç”¨å‰ç«¯å·¥ç¨‹ï¼Œä¸€ä¸ªä¸ºå•é¡µåº”ç”¨æä¾› API çš„åç«¯å·¥ç¨‹ã€‚

åŠŸèƒ½ï¼š

- SSR å’Œ SPA
- Webpack æ‰“åŒ…æœåŠ¡ç«¯æ¸²æŸ“æ¨¡æ¿å¼•æ“èµ„æº
- æ”¯æŒ github ç™»å½•
- passport å®æˆ˜ localã€githubã€jwt
- Session + Cookie å’Œ jwt èº«ä»½æ ¡éªŒ
- æƒé™èµ„æºæ§åˆ¶
- Nestjs ç‰¹æ€§è¿ç”¨æŠ€å·§ä¸å®æˆ˜

### å•é¡µé¢åº”ç”¨å’Œå¤šé¡µé¢åº”ç”¨

åœ¨å•é¡µé¢åº”ç”¨ä¸­ï¼ˆSPAï¼‰ï¼Œæ‰€æœ‰çš„èµ„æºéƒ½ä¼šä¸€æ¬¡æ€§åŠ è½½åˆ°å®¢æˆ·ç«¯ï¼ˆæˆ–è€…åªåŠ è½½æ ¸å¿ƒèµ„æºï¼Œæ‡’åŠ è½½å…¶ä»–èµ„æºï¼‰ï¼Œæ‰€æœ‰çš„åç»­å’ŒæœåŠ¡å™¨çš„äº¤äº’éƒ½æ˜¯é€šè¿‡ `Ajax` è°ƒç”¨ã€‚`html` ä»£ç æ˜¯ä½¿ç”¨ä»æœåŠ¡ç«¯æ¥æ”¶åˆ°çš„æ•°æ®åœ¨å®¢æˆ·ç«¯ç”Ÿæˆçš„ã€‚æ•´ä¸ªé¡µé¢ä¸ä¼šåˆ·æ–°ï¼Œè§†å›¾åªæ˜¯åœ¨å¿…è¦æ—¶æ¢å…¥æ¢å‡ºã€‚æœ‰è®¸å¤šçš„ `Javascript SPA` æ¡†æ¶ï¼Œæ¯”å¦‚ `Angular`ï¼Œ`React`, `Vue` ç­‰ã€‚æˆ‘ä»¬æä¾›ç®¡ç†ç³»ç»Ÿä½¿ç”¨ `Angular` çš„æ ·ä¾‹ã€‚

åœ¨å¤šé¡µé¢åº”ç”¨ä¸­ï¼ˆMPAï¼‰ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘é€è¯·æ±‚ï¼ŒæœåŠ¡ç«¯ä»£ç ï¼ˆMVC æ§åˆ¶å™¨ï¼‰ä»æ•°æ®åº“ä¸­è·å–æ•°æ®ï¼Œç„¶åé€šè¿‡è§†å›¾å¼•æ“ç”Ÿæˆ `html` ä»£ç ã€‚è¿™äº›ç¼–è¯‘åçš„é¡µé¢å‘å›ç»™å®¢æˆ·ç«¯æ˜¾ç¤ºã€‚æ¯ä¸ªæ–°çš„é¡µé¢éƒ½ä¼šå¯¼è‡´å®Œæ•´é¡µé¢çš„åˆ·æ–°ã€‚æˆ‘ä»¬æä¾› CNode åšå®¢ä½¿ç”¨çš„æ ·ä¾‹ã€‚

`SPA` å’Œ `MPA` æ¶‰åŠäº†å®Œå…¨ä¸åŒçš„æ¶æ„ã€‚å¯¹äºåå°ç®¡ç†ç³»ç»Ÿæ¥è¯´ï¼Œ`SPA` æ˜¯æœ€å¥½çš„å€™é€‰è€…ï¼›å¦ä¸€æ–¹é¢ï¼Œåšå®¢æ›´é€‚åˆ `MPA` æ¨¡å‹ï¼Œå› ä¸ºåšå®¢æ¸´æœ›è¢«æœç´¢å¼•æ“æŠ“å–æ•°æ®ã€‚è™½ç„¶æœ‰å¾ˆå¤šå·¥å…·å¯ä»¥ä½¿ `SPA` å¯¹äºæœç´¢å¼•æ“å¯è§ï¼Œä½†æ˜¯ç›®å‰çš„æœ€é è°±åšæ³•å°±æ˜¯ä½¿ç”¨ `MPA`ã€‚

## é¡¹ç›®å·¥ç¨‹åŒ–é…ç½®

å‰é¢æˆ‘ä»¬ä½¿ç”¨çš„ `Nx` åˆ›å»ºå·¥ä½œåŒºï¼Œæ„å»ºäº†å‰åé¡¹ç›®ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦ä»‹ç»æ€ä¹ˆé…ç½®é¡¹ç›®å·¥ç¨‹åŒ–ä¸€äº›ç›¸å…³é…ç½®ã€‚

> **æ³¨æ„**ï¼švs code æç¤ºçš„æ’ä»¶ä¸€å®šè¦å®‰è£…

### eslint

éšç€ `tslint` å¼ƒç”¨ï¼Œ`eslint` ä¸€ç»Ÿ `Lint` æ±Ÿå±±ã€‚`nx` é»˜è®¤ä½¿ç”¨ `eslint`ï¼Œé»˜è®¤ä½¿ç”¨ `prettier` æ ¼å¼åŒ–ä»£ç ã€‚å¹¶ä¸”æ‰©å±•ç›¸å…³æ’ä»¶ï¼š

- `@nrwl/nx/enforce-module-boundaries` æ˜¯ä¸€ä¸ªå¥½ `rules`ï¼Œå¸®åŠ©æˆ‘ä»¬ç¡®ä¿å·¥ç¨‹ä¾èµ–å¼•ç”¨é—®é¢˜ã€‚
- `@nrwl/nx/typescript|javascript` æ’ä»¶é›†æˆ `eslint-config-prettier`ã€‚

`Angular` æœ‰ [codelyzer](https://github.com/mgechev/codelyzer) è§„åˆ™ [eslint](https://github.com/angular-eslint/angular-eslint)ã€‚

å¦‚æœæƒ³è¦è‡ªå®šä¹‰è§„åˆ™ï¼š[é…ç½®è§„åˆ™](https://eslint.org/docs/rules/)ã€‚

### stylelint

[stylelint](github.com/stylelint/stylelint) ä¸€ä¸ªå¼ºå¤§çš„ linterï¼Œå¸®åŠ©æˆ‘ä»¬çš„ `style` é¿å…é”™è¯¯å’Œå¼ºåˆ¶çº¦å®šã€‚

```bash
npm install stylelint --save-dev
```

æ ¹ç›®å½•åˆ›å»º `.stylelintrc` é…ç½® `stylelint` æŸ¥çœ‹[é…ç½®è§„åˆ™](https://stylelint.io/user-guide/rules/)ã€‚

æˆ‘ä»¬é»˜è®¤ä½¿ç”¨ `SASS` éœ€è¦ä½¿ç”¨ç›¸å…³çš„ `stylelint`

```bash
npm install stylelint-config-recommended-scss stylelint-config-standard stylelint-scss stylelint-config-prettier --save-dev
```

è¿˜æœ‰å¥½ç”¨æ’ä»¶[æ¨è](https://github.com/stylelint/awesome-stylelint)ï¼š

æ¯”å¦‚å±æ€§æ’åºï¼š

```bash
npm install stylelint-order --save-dev
```

å–œæ¬¢ [BEM](https://getbem.com/introduction/) æ¨¡å¼ cssï¼Œå¯ä»¥å°è¯•ä¸€ä¸‹

```bash
npm install stylelint-selector-bem-pattern --save-dev
```

#### é…ç½®çº¦å®š

é»˜è®¤æœ‰ 4 ç§è§„åˆ™ï¼š

- ä¸­åˆ’çº¿ kebab-case: `^([a-z][a-z0-9]*)(-[a-z0-9]+)*$`
- å°é©¼å³° lowerCamelCase: `^[a-z][a-zA-Z0-9]+$`
- ä¸‹åˆ’çº¿ snake*case: `^([a-z][a-z0-9]\*)(*[a-z0-9]+)\*\$`
- å¤§é©¼å³° UpperCamelCase: `^[A-Z][a-zA-Z0-9]+$`

é¡¹ç›®ä½¿ç”¨ `ä¸­åˆ’çº¿`ï¼Œä¾‹å¦‚ï¼š`f-a`ï¼Œ`f-a-b`

å› ä¸ºä¼˜å…ˆçº§é—®é¢˜ï¼Œåœ¨ `css` æ–‡ä»¶é‡Œé¢å°½é‡å°‘ä½¿ç”¨ `id` é€‰æ‹©å™¨ã€‚`id` å¤§éƒ¨åˆ†æƒ…å†µæ˜¯åº”è¯¥åˆ†é…ç»™ `js` ä½¿ç”¨

id å‘½åï¼š`j-[a-z]+`

**æ³¨æ„**ï¼š`css` æ–‡ä»¶ä¸å­˜åœ¨ `#foo #boo{}` è¿™ç§å†™æ³•

åœ¨ Angular é‡Œéœ€è¦é…ç½®ï¼š

```json
{
  "selector-pseudo-element-no-unknown": [
    true,
    {
      "ignorePseudoElements": ["ng-deep"]
    }
  ],
  "selector-pseudo-class-no-unknown": [
    true,
    {
      "ignorePseudoClasses": ["host"]
    }
  ],
  "selector-type-no-unknown": [
    true,
    {
      "ignoreTypes": ["/^app-/", "/^router-/"]
    }
  ]
}
```

#### ç¦ç”¨è§„åˆ™

ç¦ç”¨å•è¡Œï¼ˆå½“å‰ä¸€è¡Œç”Ÿæ•ˆï¼‰

```css
a {
  padding-left: 20px !important; /* stylelint-disable-line declaration-no-important */
}
```

ç¦ç”¨å•è¡Œï¼ˆä¸‹ä¸€è¡Œç”Ÿæ•ˆï¼‰

```css
a {
  /* stylelint-disable-next-line declaration-no-important */
  padding-left: 20px !important;
}
```

ç¦ç”¨å…¨éƒ¨ï¼ˆåŒ…å«ç”Ÿæ•ˆï¼‰

```css
/* stylelint-disable */
a {
  padding-left: 20px !important;
}
/* stylelint-enable */
```

ç¦ç”¨å…¨éƒ¨ï¼ˆåŒ…å«æŸæ¡è§„åˆ™ç”Ÿæ•ˆï¼‰

```css
/* stylelint-disable declaration-no-important */
a {
  padding-left: 20px !important;
}
/* stylelint-enable */
```

### htmlhint

```bash
npm install htmlhint --save-dev
```

æ£€æŸ¥ `html` çš„ `htmlhint`ï¼Œæ¯”è¾ƒé¸¡è‚‹ï¼Œæ ¹ç›®å½•åˆ›å»ºä¸€ä¸ª`.htmlhintrc`æ–‡ä»¶ï¼ŒæŠŠé…ç½®ä¸¢è¿›å»å°±å¥½ï¼Œæ€»å…± 23 æ¡è§„åˆ™ï¼Œ[å®˜ç½‘æ–‡æ¡£](https://htmlhint.io/)ã€‚

è¿è¡Œæ£€æŸ¥

```bash
# æ‰§è¡Œå…¨éƒ¨htmlæ–‡ä»¶
node_modules/.bin/htmlhint
# æ‰§è¡Œå®¢æˆ·ç«¯ä¸‹htmlæ–‡ä»¶
node_modules/.bin/htmlhint \"apps/client/**/*.html\"
```

> vs code å†…ç½® `htmlhint` æ’ä»¶ï¼Œæˆ‘ä»¬ä¸éœ€è¦å®‰è£… `htmlhint` åŒ…ï¼Œå¦‚æœæƒ³è¦å‘½ä»¤è¡Œè¿è¡Œè‡ªå®šä¹‰è§„åˆ™å°±éœ€è¦å®‰è£…åŒ…ã€‚

### lint-staged

[lint-staged](https://github.com/okonet/lint-staged) æ˜¯ä¸€ä¸ªåœ¨ `git` æš‚å­˜åŒºä¸Šè¿è¡Œ `linters` çš„å·¥å…·ã€‚è¿˜æœ‰ä¸€ä¸ªåŒç±»å‹å·¥å…· [pretty-quick](https://github.com/azz/pretty-quick)ã€‚

Don't let ğŸ’© slip into your code base!

```bash
npm install lint-staged --save-dev
```

å®ƒçš„é…ç½®ç‰¹åˆ«ç®€å•ï¼š`package.json` é‡Œé¢å†™ä¸Š

```json
...
  "lint-staged": {
    "{apps,libs}/**/*.{ts,json,md,scss,html}": [
      "npx nx affected:lint  --uncommitted --parallel --fix",
      "npx nx format:write --uncommitted",
      "git add"
    ]
  }
```

ä¹Ÿå¯ä»¥å†™æˆå•ç‹¬é…ç½®æ–‡ä»¶ï¼Œåœ¨ `Nx` æ¨èä½¿ç”¨ `lint-staged.config.js`ã€‚

```js
const path = require('path');

module.exports = {
  '{apps,libs}/**/*.{ts,json,md,scss,html}': (files) => {
    const cwd = process.cwd();
    const filesList = files.map((file) => path.relative(cwd, file)).join(',');
    return [
      `npx nx affected:lint --parallel --fix --files=${filesList}`,
      `npx nx format:write --files=${filesList}`,
      `git add ${files.join(' ')}`,
    ];
  },
};
```

`affected` æ˜¯ `Nx` å†…ç½®çš„å‘½ä»¤ï¼Œæ£€æŸ¥å…¨éƒ¨ `lint` é—®é¢˜ï¼Œç„¶åè‡ªåŠ¨ `fix`ï¼Œå† `git` æäº¤ï¼Œè¿˜éœ€è¦é…åˆ`husky`ä½¿ç”¨ã€‚

### git commit æäº¤è§„èŒƒ

`commit` æäº¤è§„èŒƒï¼Œè¿™ä¸ªæœ€å…ˆæ˜¯ `Angular` å›¢é˜Ÿåœ¨ `github` å‘èµ·çš„ï¼Œç›®å‰å·²ç»æ˜¯å…¨çƒæœ€æµè¡Œçš„ `commit` æäº¤è§„èŒƒã€‚

æäº¤è§„èŒƒæ ¼å¼è¦æ±‚ï¼š

```text
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```

**æ³¨æ„**ï¼š

- `<type>(<scope>): <subject>`ï¼š
  - type å¿…é€‰çš„ï¼Œæäº¤çš„ç±»å‹ã€‚å…·ä½“è§æäº¤çš„ç±»å‹æšä¸¾
  - scope å¯é€‰çš„ï¼Œæè¿° commit å½±å“çš„èŒƒå›´ï¼Œæ ¹æ®æˆ‘ä»¬é¡¹ç›®å®é™…æƒ…å†µå»è®¾ç½®
  - subject å¿…é€‰çš„ï¼Œcommit çš„ç®€çŸ­æè¿°
- `<body>` å¯é€‰çš„ï¼Œæäº¤ä»£ç çš„è¯¦ç»†æè¿°
- `<footer>` å¯é€‰çš„ï¼Œå¦‚æœä»£ç çš„æäº¤æ˜¯ä¸å…¼å®¹å˜æ›´æˆ–å…³é—­ç¼ºé™·ï¼Œåˆ™ footer å¿…éœ€ï¼Œå¦åˆ™å¯ä»¥çœç•¥

æäº¤çš„ç±»å‹æšä¸¾ï¼š

- buildï¼š ä¸»è¦ç›®çš„æ˜¯ä¿®æ”¹é¡¹ç›®æ„å»ºç³»ç»Ÿ(ä¾‹å¦‚ glupï¼Œ webpackï¼Œ rollupï¼Œnpm çš„é…ç½®ç­‰.xxx) çš„æäº¤
- choreï¼š ä¸å±äºä»¥ä¸Šç±»å‹çš„å…¶ä»–ç±»å‹
- ciï¼š ä¸»è¦ç›®çš„æ˜¯ä¿®æ”¹é¡¹ç›®ç»§ç»­é›†æˆæµç¨‹(ä¾‹å¦‚ Travisï¼Œ Jenkinsï¼Œ GitLab CIï¼Œ Circle ç­‰) çš„æäº¤
- docsï¼š æ–‡æ¡£æ›´æ–°
- featï¼š æ–°å¢åŠŸèƒ½
- fixï¼š bug ä¿®å¤
- perfï¼š æ€§èƒ½, ä½“éªŒä¼˜åŒ–
- refactorï¼š é‡æ„ä»£ç (æ—¢æ²¡æœ‰æ–°å¢åŠŸèƒ½ï¼Œ ä¹Ÿæ²¡æœ‰ä¿®å¤ bug)
- release: å‘å¸ƒç‰ˆæœ¬
- revertï¼š å›æ»šæŸä¸ªæ›´æ—©ä¹‹å‰çš„æäº¤
- styleï¼š ä¸å½±å“ç¨‹åºé€»è¾‘çš„ä»£ç ä¿®æ”¹(ä¿®æ”¹ç©ºç™½å­—ç¬¦ï¼Œ æ ¼å¼ç¼©è¿›ï¼Œ è¡¥å…¨ç¼ºå¤±çš„åˆ†å·ç­‰ï¼Œ æ²¡æœ‰æ”¹å˜ä»£ç é€»è¾‘)
- testï¼š æ–°å¢æµ‹è¯•ç”¨ä¾‹æˆ–æ˜¯æ›´æ–°ç°æœ‰æµ‹è¯•

#### commitlint

[commitlint](https://github.com/conventional-changelog/commitlint) ç”¨æ¥å¸®åŠ©æˆ‘ä»¬åœ¨å¤šäººå¼€å‘æ—¶ï¼Œéµå®ˆ `git commit` æäº¤çº¦å®šã€‚

```bash
npm install @commitlint/cli @commitlint/config-conventional --save-dev
```

`commitlint` æä¾›ä¸€å¥—é…ç½®ï¼Œè¿™å¥—é…ç½®å°±æ˜¯`Angular`å›¢é˜Ÿä½¿ç”¨çš„ï¼Œæˆ‘ä»¬éœ€è¦è‡ªå®šä¹‰`scope`ï¼Œå°±éœ€è¦è‡ªå®šä¹‰é…ç½®ï¼š

åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹åˆ›å»º `commitlint.config.js` æ–‡ä»¶ï¼Œåœ¨åˆ›å»ºä¸€ä¸ª `commit.scope.config.js`ï¼Œå› ä¸ºä¸‹é¢ `.cz-config.js` ä¹Ÿéœ€è¦ã€‚

commitlint.config.js

```js
const scopeEnum = require('./commit.scope.config');

module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'header-max-length': [2, 'always', 100],
    'scope-enum': [2, 'always', scopeEnum.map((item) => item.scope)],
    'type-enum': [
      2,
      'always',
      [
        'build',
        'chore',
        'ci',
        'docs',
        'feat',
        'fix',
        'merge',
        'perf',
        'refactor',
        'release',
        'revert',
        'style',
        'test',
      ],
    ],
  },
};
```

commit.scope.config.js

```js
/**
 * scope-enum æäº¤scopeçš„æšä¸¾
 */
module.exports = [
  {
    scope: 'client',
    name: 'å®¢æˆ·ç«¯æºç ',
    readme: 'å¯¹åº”apps/client',
    remark: '',
  },
];
```

æ¯æ¬¡éœ€è¦æ–°å¢ `scope`ï¼Œåªéœ€è¦ä¿®æ”¹`commit.scope.config.js`æ–‡ä»¶å³å¯ã€‚

æ€ä¹ˆä½¿ç”¨ `commitlint`ï¼Œåœ¨è®² `husky` æ¥è¯´æ˜ã€‚

#### commitizen

æœ‰äº†è§„èŒƒçº¦æŸä»¥åï¼Œéœ€è¦æŒ‰éƒ¨å°±ç­æ‰§è¡Œã€‚æˆ‘ä»¬éœ€è¦å·¥å…·ç®€åŒ–æˆ‘ä»¬æ“ä½œï¼Œé‚£ä¹ˆå°±æœ‰å‘½ä»¤è¡Œäº¤äº’å·¥å…· [commitizen](https://github.com/commitizen/cz-cli)ã€‚

```bash
npm install commitizen --save-dev
```

ä½¿ç”¨ `npm run commit` ä»£æ›¿ `git commit`

è·Ÿç€å‘½ä»¤è¡Œï¼Œä¸€æ­¥ä¸€æ­¥å®Œæˆã€‚

åœ¨ `package.json` é…ç½®

```json
{
  "bugs": {
    "url": "https://github.com/jiayisheji/nest-cnode/issues"
  },
  "scripts": {
    "commit": "npx cz"
  }
}
```

é»˜è®¤æ˜¯è‹±æ–‡æç¤ºï¼Œä¹Ÿæ²¡æœ‰ `scope` æç¤ºï¼Œéœ€è¦æ‰‹åŠ¨è¾“å…¥ï¼Œè¿™æ ·å¯¹äºå›¢é˜Ÿåˆä½œæ¥è¯´å°±æ˜¯ä¸€åœºç¾éš¾ï¼Œæ›´åˆ«è¯´æ ¹æ® `commit` è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬æ—¥å¿—ã€‚

##### cz-customizable

[cz-customizable](https://github.com/leoforfree/cz-customizable) å¯æ”¯æŒè‡ªå®šä¹‰çš„é€‚é…å™¨ (cz-git èµ·åˆå‚ç…§å¯¹è±¡)

æ ¹æ®é…ç½®é‡Œçš„æ¨¡æ¿ä½ å¯ä»¥è®¾ç½®æƒ³è¦çš„æç¤ºè¯­ä»¥åŠ `scope` æç¤ºï¼Œæ–¹ä¾¿æ•´åˆ `commit` è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬æ—¥å¿—ã€‚

```bash
npm install cz-customizable --save-dev
```

æ ¹ç›®å½•æä¾›ä¸€ä¸ª [.cz-config.js](https://github.com/leoforfree/cz-customizable/blob/master/cz-config-EXAMPLE.js) é…ç½®æ–‡ä»¶

é…ç½® `commtizen` ä½¿ç”¨ `cz-customizable` ä½œä¸ºæ’ä»¶ã€‚å°†è¿™äº›è¡Œæ·»åŠ åˆ° `package.json` ä¸­:

```json
"config": {
  "commitizen": {
    "path": "node_modules/cz-customizable"
  },
  "cz-customizable": { // è‡ªå®šä¹‰é¡¹ç›® .cz-config.jsï¼Œå¦‚æœæ²¡æœ‰ .cz-config.js ä¼šä½¿ç”¨é»˜è®¤æ¨¡æ¿é…ç½®
    "config": ".cz-config.js"
  }
}
```

##### vs code æ’ä»¶

å¦‚æœä½ ä¸ä¹ æƒ¯å‘½ä»¤è¡Œï¼Œè¿™é‡Œæ¨è `vs code` äº¤äº’å¼æ’ä»¶ `Visual Studio Code Commitizen Support`ã€‚æ¨èæ’ä»¶åˆ—è¡¨é‡Œé¢æœ‰ã€‚

ä¸€å®šè¦åœ¨é¡¹ç›®æ ¹ç›®å½•é…ç½® `.cz-config.js`ï¼Œä»¥ä¸Šé¢ä¸€æ ·é…ç½®å³å¯ã€‚

> _.cz-config.js_ ä¿®æ”¹å†…å®¹éœ€è¦é‡å¯ vs code æ‰èƒ½ç”Ÿæ•ˆï¼ˆåŒ…æ‹¬ require ä¿®æ”¹ï¼‰

ä½¿ç”¨æ­¥éª¤ï¼š

1. æ‰“å¼€æºä»£ç ç®¡ç†ï¼ˆctrl+shift+gï¼‰æäº¤ä»£ç åˆ°æš‚å­˜çš„æ›´æ”¹
2. åœ¨æ’ä»¶æ–°ç‰ˆæœ¬ï¼Œç›´æ¥åœ¨æºä»£ç ç®¡ç†ï¼Œæäº¤æ—è¾¹æœ‰ä¸ªè“è‰²å›¾æ ‡åƒåˆ·æ–°ä¸€æ ·çš„ Conventional Commitsã€‚å¦‚æœæ²¡æœ‰è¿™ä¸ªæŒ‰é’®ä½¿ç”¨å‘½ä»¤ `ctrl+shift+p` æœç´¢ `commitizen`
3. é€‰æ‹©ç±»å‹ å‚è€ƒ `type`
4. é€‰æ‹©ä½œç”¨åŸŸ `commit.scope.config.js`ï¼Œå¦‚æœä¸æƒ³å†™ï¼Œå¯ä»¥é€‰æ‹©æœ€åä¸€ä¸ª `Custom scope...`ï¼Œè¿˜éœ€è¦åœ¨æ•²ä¸€ä¸‹å›è½¦åœ¨ä¸‹ä¸€æ­¥
5. å†™ä¸€ä¸ªç®€çŸ­çš„æè¿°ï¼ˆå¯¹åº”æ ‡å‡†é‡Œé¢ subjectï¼‰å¿…å¡«çš„ 100 å­—ä»¥å†…
6. æä¾›ä¸€ä¸ªè¾ƒé•¿æè¿°çš„ï¼ˆå¯¹åº”æ ‡å‡†é‡Œé¢ bodyï¼‰é€‰å¡«çš„ ç”¨|æ–­å¼€
7. åˆ—å‡ºä»»ä½•çªå‘æƒ…å†µï¼ˆå¯¹åº”æ ‡å‡†é‡Œé¢ footï¼‰é€‰å¡«çš„
8. å…³äºå…³é—­ bug çš„æè¿°ï¼ˆå¯¹åº”æ ‡å‡†é‡Œé¢ footï¼‰é€‰å¡«çš„ å®ƒä¼šå¯¹åº”ä½ `issues`åœ°å€

> **æ³¨æ„**ï¼šæ— è®ºå“ªç§å½¢å¼ä¸‹ï¼Œç¡®ä¿ä½ ä»£ç æäº¤åˆ°æš‚å­˜çš„æ›´æ”¹ï¼Œä¸è¦ç¦»å¼€æºä»£ç ç®¡ç†èœå•

### husky

[husky](https://github.com/typicode/husky) è®© `git hooks` å˜å¾—å¾ˆå®¹æ˜“ï¼Œæä¾› `git` ä¸€äº›å¯¹åº”æ“ä½œï¼Œå¸¸ç”¨æ¯”å¦‚`commit`ã€`push`ç­‰ã€‚

```bash
npm install husky --save-dev
```

husky åˆå§‹åŒ–

```bash
npm set-script prepare "husky install"
npm run prepare
```

æ·»åŠ  git hooks

æäº¤ä¹‹å‰æ‰§è¡Œ `lint-staged`

```bash
npx husky add .husky/pre-commit "npx --no lint-staged"
```

ä½¿ç”¨ `commitlint` æ£€æŸ¥ commit æäº¤è§„èŒƒ

```bash
npx husky add .husky/commit-msg "npx --no -- commitlint --edit $1"
```

å¦‚æœåœ¨ `Windows` ç¯å¢ƒæ·»åŠ å¤±è´¥ï¼Œå¯ä»¥ä½¿ç”¨ `Yarn`ã€‚ä¹Ÿå¯ä»¥åœ¨ä¸åŠ æ‰§è¡Œè„šæœ¬å‘½ä»¤ï¼Œæ¯”å¦‚ï¼š`npx husky add .husky/commit-msg`ï¼Œè¿™æ ·ä½ è¾“å…¥å¼•å·åœ°æ–¹å°±ä¼šè¢« `undefined` å ä½ï¼Œä½ åªéœ€è¦æ›¿æ¢å³å¯ã€‚

> **æ³¨æ„**ï¼šhusky å¤§ç‰ˆæœ¬ä¹‹é—´å†™æ³•éƒ½æœ‰äº›å·®å¼‚ï¼Œè¯·è®¤çœŸçœ‹[æ–‡æ¡£](https://typicode.github.io/husky)

### ç‰ˆæœ¬æ—¥å¿—

æœ‰ä¸Šé¢çš„ `commit` æäº¤è§„èŒƒçº¦æŸï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ® `commit` ä¿¡æ¯æ¥è‡ªåŠ¨ç”Ÿæˆç‰ˆæœ¬æ—¥å¿—ã€‚

```bash
npm install standard-version --save-dev
```

ä½¿ç”¨éå¸¸ç®€å•ï¼Œå®ƒä¼šè‡ªåŠ¨æ‰“ `git tag`ã€‚

åœ¨ `package.json` é…ç½®å³å¯

```json
...
  "scrips": {
    ....
    "release": "standard-version",
    "publish": "standard-version && git push --follow-tags origin master"
  }
```

åªéœ€è¦è®°å¾—å‡ ä¸ªå‘½ä»¤å³å¯ï¼š

- `publish`: ç›´æ¥ `push` åˆ°è¿œç«¯ `master`
- `release`ï¼šåšå¿«æ·å‘½ä»¤ï¼Œéœ€è¦æ‰‹åŠ¨ `push` ä»£ç ï¼ˆé»˜è®¤ç‰ˆæœ¬ç´¯åŠ ï¼‰

  - åˆæ¬¡æäº¤ï¼š`npm run release -- --first-release`
  - é¢„å‘å¸ƒç‰ˆæœ¬ï¼š`npm run release -- --prerelease`
  - é¢„å‘å¸ƒå‰ç¼€ç‰ˆæœ¬ï¼š`npm run release -- --prerelease alpha`
  - æ›´æ–°ä¸»è¦ç‰ˆæœ¬ï¼š`npm run release -- --release-as major`
  - æ›´æ–°å°ç‰ˆæœ¬ï¼š`npm run release -- --release-as minor`
  - æ›´æ–°è¡¥ä¸ç‰ˆæœ¬ï¼š`npm run release -- --release-as patch`
  - æ›´æ–°æŒ‡å®šç‰ˆæœ¬ï¼š`npm run release -- --release-as 1.1.0`

å›¢é˜Ÿé£æ ¼åŒ–ï¼ŒåŸºæœ¬é…ç½®å®Œæˆï¼Œä½ å¯ä»¥å‚ç…§ `lint` å„ç§è§„åˆ™ï¼Œè‡ªå®šä¹‰ï¼Œæ¥çº¦æŸä½ å›¢é˜Ÿçš„ä»£ç é£æ ¼ä¹ æƒ¯ã€‚

> æ— è§„çŸ©ä¸æˆæ–¹åœ†ï¼Œå…»æˆå¥½ä¹ æƒ¯æ‰èƒ½åœ¨å›¢é˜Ÿé‡Œæ··çš„ä¸‹å»ã€‚
