# 初始化项目

古人云:工欲善其事，必先利其器，这里给大家准备 `windows` 玩家必备的软件，[传送门](https://pan.baidu.com/s/1kQwJx4WpgMz1Lti0Y9moNg)，口令：【9ofr】。

接下来需要很多命令行操作，我们需要一个强大的命令行工具，`Windows 10` 已经推出了 [windows terminal](https://github.com/Microsoft/Terminal)，需要自己手动[安装](https://apps.microsoft.com/store/detail/windows-terminal/9N0DX20HK701?hl=zh-cn&gl=cn)，Windows 11 默认命令行工具。可以自行搜索美好工具，配合 `oh-my-posh` 打造好用的命令行工具。

受限网络原因，或者懒得折腾，或者折腾失败，推荐使用 [cmder](cmder.net)。如果你不知道如何安装和使用，那么需要求解搜索引擎了，打开浏览器 [传送门](https://cn.bing.com/search?q=cmder&qs=n&form=QBRE&sp=-1&pq=cmder&sc=8-5&sk=&cvid=DA71E8C8A5914CAB9236A8C0F193C787)。

有了命令行工具需要一个不错的编辑器，这里推荐 [vs code](https://code.visualstudio.com/)，点击下载安装。

推荐一些我常用的必备插件(ps: 插件不要太多，有些插件比较坑，烧内存和 cpu，注意辨别)和配置：

项目根目录下会有 `.vscode` 文件夹

```text
.vscode/extensions.json  // 必备插件
.vscode/launch.json      // 断点调试配置
.vscode/settings.json    // 项目配置
```

## 使用 `nvm` 安装 `nodejs`

一般开发 `nodejs` 都需要安装 `nodejs` 环境，随着 `nodejs` 版本不断迭代，有种跟不上节奏，不同版本会有一些差异化，如果你现在开发环境是早期 nodejs 版本，那么你开心更新版本，可能就会哭了，会报各种懵逼的错误让你欲罢不能。那怎么办了，就有一个 `node` 版本管理的工具---[nvm](https://github.com/creationix/nvm)诞生。（ps：这个是 windows 用户用不了，必备软件里面 `nvm-setup` 就是 windows 用户专用）

如果你不知道如何安装和使用 `nvm-windows` [传送门](https://cn.bing.com/search?q=nvm-windows&qs=n&form=QBRE&sp=-1&pq=nvm-windows&sc=8-11&sk=&cvid=8F45D5194FCC45F098E949612179D489)。

> **注意**：如果电脑已经安装过`nodejs`，需要先卸载，请记住它的版本号，在安装 `nvm-windows`。

现在你应该安装完成了 `nvm-windows`，那么就可以开始安装 `nodejs` 版本，如果你之前有安装 `nodejs` ，请先:(例如我之前安装 v12.13)

```bash
nvm install v12.13
```

安装完成以后再安装本项目使用版本：

```bash
nvm install v14.15.0
```

安装过程可能会出现一个错误，下载`npm`错误：

```text
Please visit https://github.com/npm/npm/releases/tag/v[npm版本] to download npm.
```

要你去这个地址下载，其实是错误，这个指向是`npm-cli`v[npm 版本]，我们需要手动去下载它

```text
https://codeload.github.com/npm/cli/zip/v[npm版本]
```

把它拷贝到你的 `nvm` 目录下，对应版本`nodejs`版本，解压到`node_modules`里，把文件夹重命名为`npm`。下载必备的软件里面的`npm`文件夹，把里面内容拷贝到对应版本`nodejs`版本即可。

另外一种就是借助淘宝源：

安装目录 `\nvm\settings.txt` 在这个文件后面跟上这 2 句

```text
node_mirror: https://registry.npmmirror.com/binary.html?path=node/
npm_mirror: https://registry.npmmirror.com/binary.html?path=npm/
```

然后 `nvm install v14.15.0`，按提示操作即可。（如果出现提示没有可用的版本，移除淘宝源）

切换当前版本并检查是否靠谱：

```bash
nvm use v14.15.0
node -v   // v14.15.0
npm -v    // v6.14.8
# exit status 1: 在切换时如果遇到这个错误，请使用管理员权限打开终端
```

**注意**：`nvm-windows`一定要安装好，检查靠谱，只会出现 `npm -v` 会报错，如果你按我的使用方式就不会出现问题。如果你在出问题了，可以联系我帮你看看。

### .nvmrc 和 .npmrc 配置

创建 `.nvmrc` 文件，里面写上 `14.15.0` 指定版本

> 注意：nvm-windows 对此配置可能无效

创建 `.npmrc` 文件，里面写上 `registry=https://registry.npmmirror.com/` 淘宝镜像源

## 使用 Nx 构建项目

### Nx 是什么

`Nx` 是一组针对 `monorepos` 的可扩展开发工具，它可以帮助你像 `Google`、`Facebook` 和 `Microsoft` 那样进行开发。它对许多前端和后端技术提供一流的支持，因此其文档具有多种风格。

#### 使用现代工具

使用 `Nx`，你可以将 `TypeScript`，`Cypress`，`Jest`，`Prettier`，`Storybook` 添加到你的开发工作流程中。 `Nx` 设置了这些工具，并允许你无缝使用它们。 这些创新工具具有很多优势，可以帮助你更好，更省心地工作。

#### 构建全栈应用程序

使用`Nx`，你可以使用现代框架构建全栈应用程序。 你可以在前端和后端之间共享代码。 你可以使用相同的 `build`/`test`/`serve` 命令来增强整个开发经验。

#### 学习 Google，Facebook 和 Microsoft 一样开发实践

使用`Nx`，你可以整体开发多个全栈应用程序，并在同一工作区中共享它们之间的代码。 `Nx` 提供了高级工具，可帮助你扩展企业发展。 `Nx` 还有助于实施组织的标准和社区最佳实践。

#### 不同技术栈组合，统一构建工具

使用`Nx`，你可以`Angular`、`React`、`Web Components`、`Nestjs`、`Express`、`Nodejs`技术做自由组合，构建你的项目技术栈。不用担心构建工具问题，`Nx` 帮你一键搞定。

### monorepo 和 multrepo

#### 什么是 monorepo

> 是将所有的模块统一的放在一个主干分支之中管理。不进行分库存储，当有特定的需要的时候进行分支，但是问题修改还是在主干上操作，并有专门人员合并到分支内容上，在特定需求完结的时候，分支也将会被废弃。如果想了解更多，[传送门](https://trunkbaseddevelopment.com/monorepos/)。

优点：

1. 统一的规范，语言，和 IDE 带来的是结构的完整稳定。
2. 按照统一的标准进行开发，是哦程序稳定性更良好，更易解读。
3. 标准化的开发流程，规避很多不必要的冲突与错误。

缺点：

1. 项目过大，难以管理。
2. 由于统一的标准，不同的团队可能需要对于新的规范和 IDE 进行了解学习，需要时间。
3. 修改和开发可能变得繁琐，减慢效率。

#### 什么是 multrepo

> 将项目分化成为多个模块，并针对每一个模块单独的开辟一个 repository 来进行管理。

优点：

1. 团队自己的 IDE，语言，以及工作步调。
2. 模块更小，更易维护。
3. 开发效率更高。

缺点：

1. 合并困难，每个模块规范不同，同步和编译时这些问题将会集体爆发。
2. 难以保证稳定性。
3. 由于可能存在不同语言开发，或者不同 IDE 的情况，新建或者更新构建变得困难。

#### 为什么选择 Nx

想要使用 `monorepo` 需要借助一个强大的工具才能高效的发挥作用。

这里有关于 [monorepo tools](https://monorepo.tools) 和 monorepo 深入介绍和学习资料，里面有目前 github 流行的 monorepo tools，综合对比来说 `Nx` 是一款不错的 monorepo tools

> Nx 最开始是一个 [Angular-cli](https://github.com/angular/angular-cli) 的扩展工具，学习它成本不高，只需要你按照下列方式安装就行了，使用非常简单，学习更多[使用文档](https://nx.dev)

`Nx` 的亮点很多，这里简单介绍一些：

- 支持 `React` 构建
- 支持 `React` 和 `Angular` 共存一个项目中
- 支持选择测试工具，可以选择`jest`和`cypress`
- 支持全栈 `node` 项目一起构建
- 构建多个 `apps`
- 构建多个 `libs`

> 最后，`Nx` 鼓励开发者在使用自定义 `library`，来构建项目，让你的 `Apps` 简洁明了。

如果你喜欢图形界面，可以试试 [Angular Console](https://angularconsole.com/)。

`Nx` 还有一个比较大亮点，借助 `Angular-cli` 开源的 [schematics](https://www.npmjs.com/package/@angular-devkit/schematics-cli) 工具，开源快速生成想要模板，还可以定制工作区模板 [tools/generators](https://nx.dev/generators/workspace-generators)。

`Nx` 还要更加灵活的扩展执行命令功能：

- 通过 [nx:run-commands](https://nx.dev/executors/run-commands-builder) 执行脚本命令来强化默认 `executor` 执行命令。
- 简单定制工作区 [tools/executors](https://nx.dev/executors/creating-custom-builders) 来强化默认 `executor` 执行命令。

定制自己的[插件](https://nx.dev/extending-nx/nx-devkit)来扩展项目的 `generators` 和 `executor` 能力。

#### 安装 Nx

Nx 初始化叫创建工作区，可以使用以下三种方式安装

npx

```bash
npx create-nx-workspace@latest
```

npm init

```bash
npm init nx-workspace
```

yarn create

```bash
yarn create nx-workspace
```

我们这里使用 `npx`，它们有什么不同，这里就不展开说明，自行搜索引擎科普。

运行上面安装命令行以后，就等着出现 `npx: 166 安装成功，用时 42.249 秒`

填写工作区的名字：

- Workspace name：`nest-cnode`

然后就会出现有奖知识问答环节：选择 `angular-nest`

- What to create in the new workspace (Use arrow keys)：

  - empty [an empty workspace]
  - web components [a workspace with a single app built using web components]
  - angular [a workspace with a single Angular application]
  - angular-nest [a workspace with a full stack application (Angular + Nest)]
  - react [a workspace with a single React application]
  - react-express [a workspace with a full stack application (React + Express)]
  - next.js [a workspace with a single Next.js application]

- Application name：admin (这里是第一次创建 angular 项目的名字，)

- Default stylesheet format：选择 `SASS` (需要使用 [@angular/material](https://github.com/angular/components), 只能选择，如果你使用 [NG-ZORRO](https://github.com/NG-ZORRO/ng-zorro-antd) 可以选择 `LESS`)

  - CSS
  - SASS(.scss) [ <http://sass-lang.com> ]
  - Stylus(.styl) [ <http://stylus-lang.com> ]
  - LESS [ <http://lesscss.org> ]

选择之后，出现 `Creating a sandbox with Nx...`，等待安装 `node_modules`，安装完成以后打开 `vs code` 就好提示安装插件，安装就好了，其中一个叫 `nx-console`，这是 `nx` 的 `vs code` 插件，后面生成文件，生成 `lib`，等全靠它。

> 目前安装 `nx` 方式很多，结果也不一样，按上面方式安装，如果有一个 `angular.json`, 你需要把它 `version` 改成 2，然后使用 `vs code` 的 `nrwl.angular-console` 点击 `Generate`，找到 `@nrwl/workspace:convert-to-nx-project`, 勾选 `all`, 完成工作区迁移，这样就会生成一个 `workspace.json` 文件，这样这个文件只有相关项目和路径映射，大大减少了 `workspace.json` 文件的大小，每个项目都会自动生成一个 `project.json` 文件来管理当前项目的配置。

## 项目规划

关于 [cnodejs](https://cnodejs.org) 社区是一个服务端渲染的网站，用户和管理员都是同时存在，管理员登录有更多的权限操作。支持第三方 `github` 登录，使用 `Session + Cookie` 身份校验。

为了更加丰富功能，做了一些调整，面向用户还是服务端渲染，面向管理员单独做一个管理后台，使用单页应用。

简单理解就是，一个服务端渲染后端工程，一个单页面应用前端工程，一个为单页应用提供 API 的后端工程。

功能：

- SSR 和 SPA
- Webpack 打包服务端渲染模板引擎资源
- 支持 github 登录
- passport 实战 local、github、jwt
- Session + Cookie 和 jwt 身份校验
- 权限资源控制
- Nestjs 特性运用技巧与实战

### 单页面应用和多页面应用

在单页面应用中（SPA），所有的资源都会一次性加载到客户端（或者只加载核心资源，懒加载其他资源），所有的后续和服务器的交互都是通过 `Ajax` 调用。`html` 代码是使用从服务端接收到的数据在客户端生成的。整个页面不会刷新，视图只是在必要时换入换出。有许多的 `Javascript SPA` 框架，比如 `Angular`，`React`, `Vue` 等。我们提供管理系统使用 `Angular` 的样例。

在多页面应用中（MPA），客户端向服务端发送请求，服务端代码（MVC 控制器）从数据库中获取数据，然后通过视图引擎生成 `html` 代码。这些编译后的页面发回给客户端显示。每个新的页面都会导致完整页面的刷新。我们提供 CNode 博客使用的样例。

`SPA` 和 `MPA` 涉及了完全不同的架构。对于后台管理系统来说，`SPA` 是最好的候选者；另一方面，博客更适合 `MPA` 模型，因为博客渴望被搜索引擎抓取数据。虽然有很多工具可以使 `SPA` 对于搜索引擎可见，但是目前的最靠谱做法就是使用 `MPA`。

## 项目工程化配置

前面我们使用的 `Nx` 创建工作区，构建了前后项目，这里我们主要介绍怎么配置项目工程化一些相关配置。

> **注意**：vs code 提示的插件一定要安装

### eslint

随着 `tslint` 弃用，`eslint` 一统 `Lint` 江山。`nx` 默认使用 `eslint`，默认使用 `prettier` 格式化代码。并且扩展相关插件：

- `@nrwl/nx/enforce-module-boundaries` 是一个好 `rules`，帮助我们确保工程依赖引用问题。
- `@nrwl/nx/typescript|javascript` 插件集成 `eslint-config-prettier`。

`Angular` 有 [codelyzer](https://github.com/mgechev/codelyzer) 规则 [eslint](https://github.com/angular-eslint/angular-eslint)。

如果想要自定义规则：[配置规则](https://eslint.org/docs/rules/)。

### stylelint

[stylelint](github.com/stylelint/stylelint) 一个强大的 linter，帮助我们的 `style` 避免错误和强制约定。

```bash
npm install stylelint --save-dev
```

根目录创建 `.stylelintrc` 配置 `stylelint` 查看[配置规则](https://stylelint.io/user-guide/rules/)。

我们默认使用 `SASS` 需要使用相关的 `stylelint`

```bash
npm install stylelint-config-recommended-scss stylelint-config-standard stylelint-scss stylelint-config-prettier --save-dev
```

还有好用插件[推荐](https://github.com/stylelint/awesome-stylelint)：

比如属性排序：

```bash
npm install stylelint-order --save-dev
```

喜欢 [BEM](https://getbem.com/introduction/) 模式 css，可以尝试一下

```bash
npm install stylelint-selector-bem-pattern --save-dev
```

#### 配置约定

默认有 4 种规则：

- 中划线 kebab-case: `^([a-z][a-z0-9]*)(-[a-z0-9]+)*$`
- 小驼峰 lowerCamelCase: `^[a-z][a-zA-Z0-9]+$`
- 下划线 snake*case: `^([a-z][a-z0-9]\*)(*[a-z0-9]+)\*\$`
- 大驼峰 UpperCamelCase: `^[A-Z][a-zA-Z0-9]+$`

项目使用 `中划线`，例如：`f-a`，`f-a-b`

因为优先级问题，在 `css` 文件里面尽量少使用 `id` 选择器。`id` 大部分情况是应该分配给 `js` 使用

id 命名：`j-[a-z]+`

**注意**：`css` 文件不存在 `#foo #boo{}` 这种写法

在 Angular 里需要配置：

```json
{
  "selector-pseudo-element-no-unknown": [
    true,
    {
      "ignorePseudoElements": ["ng-deep"]
    }
  ],
  "selector-pseudo-class-no-unknown": [
    true,
    {
      "ignorePseudoClasses": ["host"]
    }
  ],
  "selector-type-no-unknown": [
    true,
    {
      "ignoreTypes": ["/^app-/", "/^router-/"]
    }
  ]
}
```

#### 禁用规则

禁用单行（当前一行生效）

```css
a {
  padding-left: 20px !important; /* stylelint-disable-line declaration-no-important */
}
```

禁用单行（下一行生效）

```css
a {
  /* stylelint-disable-next-line declaration-no-important */
  padding-left: 20px !important;
}
```

禁用全部（包含生效）

```css
/* stylelint-disable */
a {
  padding-left: 20px !important;
}
/* stylelint-enable */
```

禁用全部（包含某条规则生效）

```css
/* stylelint-disable declaration-no-important */
a {
  padding-left: 20px !important;
}
/* stylelint-enable */
```

### htmlhint

```bash
npm install htmlhint --save-dev
```

检查 `html` 的 `htmlhint`，比较鸡肋，根目录创建一个`.htmlhintrc`文件，把配置丢进去就好，总共 23 条规则，[官网文档](https://htmlhint.io/)。

运行检查

```bash
# 执行全部html文件
node_modules/.bin/htmlhint
# 执行客户端下html文件
node_modules/.bin/htmlhint \"apps/client/**/*.html\"
```

> vs code 内置 `htmlhint` 插件，我们不需要安装 `htmlhint` 包，如果想要命令行运行自定义规则就需要安装包。

### lint-staged

[lint-staged](https://github.com/okonet/lint-staged) 是一个在 `git` 暂存区上运行 `linters` 的工具。还有一个同类型工具 [pretty-quick](https://github.com/azz/pretty-quick)。

Don't let 💩 slip into your code base!

```bash
npm install lint-staged --save-dev
```

它的配置特别简单：`package.json` 里面写上

```json
...
  "lint-staged": {
    "{apps,libs}/**/*.{ts,json,md,scss,html}": [
      "npx nx affected:lint  --uncommitted --parallel --fix",
      "npx nx format:write --uncommitted",
      "git add"
    ]
  }
```

也可以写成单独配置文件，在 `Nx` 推荐使用 `lint-staged.config.js`。

```js
const path = require('path');

module.exports = {
  '{apps,libs}/**/*.{ts,json,md,scss,html}': (files) => {
    const cwd = process.cwd();
    const filesList = files.map((file) => path.relative(cwd, file)).join(',');
    return [
      `npx nx affected:lint --parallel --fix --files=${filesList}`,
      `npx nx format:write --files=${filesList}`,
      `git add ${files.join(' ')}`,
    ];
  },
};
```

`affected` 是 `Nx` 内置的命令，检查全部 `lint` 问题，然后自动 `fix`，再 `git` 提交，还需要配合`husky`使用。

### git commit 提交规范

`commit` 提交规范，这个最先是 `Angular` 团队在 `github` 发起的，目前已经是全球最流行的 `commit` 提交规范。

提交规范格式要求：

```text
<type>(<scope>): <subject>
<BLANK LINE>
<body>
<BLANK LINE>
<footer>
```

**注意**：

- `<type>(<scope>): <subject>`：
  - type 必选的，提交的类型。具体见提交的类型枚举
  - scope 可选的，描述 commit 影响的范围，根据我们项目实际情况去设置
  - subject 必选的，commit 的简短描述
- `<body>` 可选的，提交代码的详细描述
- `<footer>` 可选的，如果代码的提交是不兼容变更或关闭缺陷，则 footer 必需，否则可以省略

提交的类型枚举：

- build： 主要目的是修改项目构建系统(例如 glup， webpack， rollup，npm 的配置等.xxx) 的提交
- chore： 不属于以上类型的其他类型
- ci： 主要目的是修改项目继续集成流程(例如 Travis， Jenkins， GitLab CI， Circle 等) 的提交
- docs： 文档更新
- feat： 新增功能
- fix： bug 修复
- perf： 性能, 体验优化
- refactor： 重构代码(既没有新增功能， 也没有修复 bug)
- release: 发布版本
- revert： 回滚某个更早之前的提交
- style： 不影响程序逻辑的代码修改(修改空白字符， 格式缩进， 补全缺失的分号等， 没有改变代码逻辑)
- test： 新增测试用例或是更新现有测试

#### commitlint

[commitlint](https://github.com/conventional-changelog/commitlint) 用来帮助我们在多人开发时，遵守 `git commit` 提交约定。

```bash
npm install @commitlint/cli @commitlint/config-conventional --save-dev
```

`commitlint` 提供一套配置，这套配置就是`Angular`团队使用的，我们需要自定义`scope`，就需要自定义配置：

在项目根目录下创建 `commitlint.config.js` 文件，在创建一个 `commit.scope.config.js`，因为下面 `.cz-config.js` 也需要。

commitlint.config.js

```js
const scopeEnum = require('./commit.scope.config');

module.exports = {
  extends: ['@commitlint/config-conventional'],
  rules: {
    'header-max-length': [2, 'always', 100],
    'scope-enum': [2, 'always', scopeEnum.map((item) => item.scope)],
    'type-enum': [
      2,
      'always',
      [
        'build',
        'chore',
        'ci',
        'docs',
        'feat',
        'fix',
        'merge',
        'perf',
        'refactor',
        'release',
        'revert',
        'style',
        'test',
      ],
    ],
  },
};
```

commit.scope.config.js

```js
/**
 * scope-enum 提交scope的枚举
 */
module.exports = [
  {
    scope: 'client',
    name: '客户端源码',
    readme: '对应apps/client',
    remark: '',
  },
];
```

每次需要新增 `scope`，只需要修改`commit.scope.config.js`文件即可。

怎么使用 `commitlint`，在讲 `husky` 来说明。

#### commitizen

有了规范约束以后，需要按部就班执行。我们需要工具简化我们操作，那么就有命令行交互工具 [commitizen](https://github.com/commitizen/cz-cli)。

```bash
npm install commitizen --save-dev
```

使用 `npm run commit` 代替 `git commit`

跟着命令行，一步一步完成。

在 `package.json` 配置

```json
{
  "bugs": {
    "url": "https://github.com/jiayisheji/nest-cnode/issues"
  },
  "scripts": {
    "commit": "npx cz"
  }
}
```

默认是英文提示，也没有 `scope` 提示，需要手动输入，这样对于团队合作来说就是一场灾难，更别说根据 `commit` 自动生成版本日志。

##### cz-customizable

[cz-customizable](https://github.com/leoforfree/cz-customizable) 可支持自定义的适配器 (cz-git 起初参照对象)

根据配置里的模板你可以设置想要的提示语以及 `scope` 提示，方便整合 `commit` 自动生成版本日志。

```bash
npm install cz-customizable --save-dev
```

根目录提供一个 [.cz-config.js](https://github.com/leoforfree/cz-customizable/blob/master/cz-config-EXAMPLE.js) 配置文件

配置 `commtizen` 使用 `cz-customizable` 作为插件。将这些行添加到 `package.json` 中:

```json
"config": {
  "commitizen": {
    "path": "node_modules/cz-customizable"
  },
  "cz-customizable": { // 自定义项目 .cz-config.js，如果没有 .cz-config.js 会使用默认模板配置
    "config": ".cz-config.js"
  }
}
```

##### vs code 插件

如果你不习惯命令行，这里推荐 `vs code` 交互式插件 `Visual Studio Code Commitizen Support`。推荐插件列表里面有。

一定要在项目根目录配置 `.cz-config.js`，以上面一样配置即可。

> _.cz-config.js_ 修改内容需要重启 vs code 才能生效（包括 require 修改）

使用步骤：

1. 打开源代码管理（ctrl+shift+g）提交代码到暂存的更改
2. 在插件新版本，直接在源代码管理，提交旁边有个蓝色图标像刷新一样的 Conventional Commits。如果没有这个按钮使用命令 `ctrl+shift+p` 搜索 `commitizen`
3. 选择类型 参考 `type`
4. 选择作用域 `commit.scope.config.js`，如果不想写，可以选择最后一个 `Custom scope...`，还需要在敲一下回车在下一步
5. 写一个简短的描述（对应标准里面 subject）必填的 100 字以内
6. 提供一个较长描述的（对应标准里面 body）选填的 用|断开
7. 列出任何突发情况（对应标准里面 foot）选填的
8. 关于关闭 bug 的描述（对应标准里面 foot）选填的 它会对应你`issues`地址

> **注意**：无论哪种形式下，确保你代码提交到暂存的更改，不要离开源代码管理菜单

### husky

[husky](https://github.com/typicode/husky) 让 `git hooks` 变得很容易，提供 `git` 一些对应操作，常用比如`commit`、`push`等。

```bash
npm install husky --save-dev
```

husky 初始化

```bash
npm set-script prepare "husky install"
npm run prepare
```

添加 git hooks

提交之前执行 `lint-staged`

```bash
npx husky add .husky/pre-commit "npx --no lint-staged"
```

使用 `commitlint` 检查 commit 提交规范

```bash
npx husky add .husky/commit-msg "npx --no -- commitlint --edit $1"
```

如果在 `Windows` 环境添加失败，可以使用 `Yarn`。也可以在不加执行脚本命令，比如：`npx husky add .husky/commit-msg`，这样你输入引号地方就会被 `undefined` 占位，你只需要替换即可。

> **注意**：husky 大版本之间写法都有些差异，请认真看[文档](https://typicode.github.io/husky)

### 版本日志

有上面的 `commit` 提交规范约束，我们就可以根据 `commit` 信息来自动生成版本日志。

```bash
npm install standard-version --save-dev
```

使用非常简单，它会自动打 `git tag`。

在 `package.json` 配置即可

```json
...
  "scrips": {
    ....
    "release": "standard-version",
    "publish": "standard-version && git push --follow-tags origin master"
  }
```

只需要记得几个命令即可：

- `publish`: 直接 `push` 到远端 `master`
- `release`：做快捷命令，需要手动 `push` 代码（默认版本累加）

  - 初次提交：`npm run release -- --first-release`
  - 预发布版本：`npm run release -- --prerelease`
  - 预发布前缀版本：`npm run release -- --prerelease alpha`
  - 更新主要版本：`npm run release -- --release-as major`
  - 更新小版本：`npm run release -- --release-as minor`
  - 更新补丁版本：`npm run release -- --release-as patch`
  - 更新指定版本：`npm run release -- --release-as 1.1.0`

团队风格化，基本配置完成，你可以参照 `lint` 各种规则，自定义，来约束你团队的代码风格习惯。

> 无规矩不成方圆，养成好习惯才能在团队里混的下去。
